<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Introduction to fastknn &bull; fastknn</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">fastknn</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/davpinto/fastknn">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction to fastknn</h1>
                        <h4 class="author">David Pinto</h4>
            
          </div>

    
    
<div class="contents">
<p>The goal of <strong>fastknn</strong> is to make it easy for machine learning researchers and Kaggle competitors to create and tune KNN classifiers for very large datasets. It is based on the <a href="https://www.cs.umd.edu/~mount/ANN/">ANN</a> library for fast nearest neighbor searching.</p>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#getting-started" class="anchor"> </a></body></html>Getting Started</h2>
<p>In this example <strong>fastknn</strong> is applied over a sample of size 50k from the <a href="https://archive.ics.uci.edu/ml/datasets/Covertype">Covertype</a> dataset. It contains 54 binary variables and 7 possible class labels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Load packages
<span class="kw">library</span>(<span class="st">"fastknn"</span>)
<span class="kw">library</span>(<span class="st">"caTools"</span>)

## Load data
<span class="kw">data</span>(<span class="st">"covertype"</span>, <span class="dt">package =</span> <span class="st">"fastknn"</span>)
x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(covertype[, -<span class="dv">55</span>])
y &lt;-<span class="st"> </span><span class="kw">as.factor</span>(covertype$Target)

## Split data for training and test
<span class="kw">set.seed</span>(<span class="dv">123</span>)
tr.idx &lt;-<span class="st"> </span><span class="kw">which</span>(caTools::<span class="kw">sample.split</span>(<span class="dt">Y =</span> y, <span class="dt">SplitRatio =</span> <span class="fl">0.7</span>))
x.tr   &lt;-<span class="st"> </span>x[tr.idx, ]
x.te   &lt;-<span class="st"> </span>x[-tr.idx, ]
y.tr   &lt;-<span class="st"> </span>y[tr.idx]
y.te   &lt;-<span class="st"> </span>y[-tr.idx]

## Fit KNN
t1 &lt;-<span class="st"> </span><span class="kw">system.time</span>({
   knn.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fastknn.html">fastknn</a></span>(x.tr, y.tr, x.te, <span class="dt">k =</span> <span class="dv">15</span>, <span class="dt">method =</span> <span class="st">"dist"</span>)
})
t1</code></pre></div>
<table style="width:47%;" class="table"><colgroup><col width="16%"><col width="15%"><col width="15%"></colgroup><thead><tr class="header"><th align="center">user.self</th>
<th align="center">sys.self</th>
<th align="center">elapsed</th>
</tr></thead><tbody><tr class="odd"><td align="center">0.64</td>
<td align="center">0.016</td>
<td align="center">0.657</td>
</tr></tbody></table><p>Extremely fast!</p>
</div>
<div id="pre-processing" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#pre-processing" class="anchor"> </a></body></html>Pre-Processing</h2>
<p>The <code><a href="../reference/fastknn.html">fastknn()</a></code> function provides 4 options to normalize data before the nearest neighbors searching process:</p>
<ul><li><code>normalize="std"</code>: standardize variables by removing the mean and scaling to unit variance.</li>
<li><code>normalize="minmax"</code>: transforms variables by scaling each one between 0 and 1.</li>
<li><code>normalize="maxabs"</code>: scales each variable by its maximum absolute value. This is the best choice for sparse data because it does not shift/center the variables.</li>
<li><code>normalize="robust"</code>: scales variables using statistics that are robust to outliers. It removes the median and scales by the interquartile range (IQR).</li>
</ul><div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Apply min-max normalization
knn.norm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fastknn.html">fastknn</a></span>(x.tr, y.tr, x.te, <span class="dt">k =</span> <span class="dv">15</span>, <span class="dt">method =</span> <span class="st">"dist"</span>, <span class="dt">normalize =</span> <span class="st">"minmax"</span>)

## Performance without normalization
<span class="kw">sprintf</span>(<span class="st">"Logloss without normalization: %.3f"</span>, <span class="kw"><a href="../reference/classLoss.html">classLoss</a></span>(y.te, <span class="dt">prob =</span> knn.out$prob, <span class="dt">eval.metric =</span> <span class="st">"logloss"</span>))

## Performance with nromalization
<span class="kw">sprintf</span>(<span class="st">"Logloss with normalization: %.3f"</span>, <span class="kw"><a href="../reference/classLoss.html">classLoss</a></span>(y.te, <span class="dt">prob =</span> knn.norm$prob, <span class="dt">eval.metric =</span> <span class="st">"logloss"</span>))</code></pre></div>
<pre><code>## [1] "Logloss without normalization: 0.507"</code></pre>
<pre><code>## [1] "Logloss with normalization: 0.611"</code></pre>
<p>For this dataset, normalization had a negative effect on classification performance, but in many cases it is important to transform variables to the same unit before fitting KNN.</p>
</div>
<div id="find-the-best-k" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#find-the-best-k" class="anchor"> </a></body></html>Find the Best k</h2>
<p>The <strong>fastknn</strong> provides a n-fold cross-validation procedure to define the best <em>k</em> according to 4 different evaluation metrics:</p>
<ol style="list-style-type: decimal"><li><code>"overall_error"</code>: overall misclassification rate</li>
<li><code>"mean_error"</code>: average in-class misclassification rate</li>
<li><code>"auc"</code>: average in-class area under the ROC curve</li>
<li><code>"logloss"</code>: cross-entropy error</li>
</ol><div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cv.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fastknnCV.html">fastknnCV</a></span>(x, y, <span class="dt">k =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>), <span class="dt">method =</span> <span class="st">"dist"</span>, <span class="dt">folds =</span> <span class="dv">5</span>, <span class="dt">eval.metric =</span> <span class="st">"overall_error"</span>)
cv.out$cv_table</code></pre></div>
<table style="width:76%;" class="table"><colgroup><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="9%"><col width="4%"></colgroup><thead><tr class="header"><th align="center">fold_1</th>
<th align="center">fold_2</th>
<th align="center">fold_3</th>
<th align="center">fold_4</th>
<th align="center">fold_5</th>
<th align="center">mean</th>
<th align="center">k</th>
</tr></thead><tbody><tr class="odd"><td align="center">0.1189</td>
<td align="center">0.123</td>
<td align="center">0.1274</td>
<td align="center">0.1304</td>
<td align="center">0.1207</td>
<td align="center">0.1241</td>
<td align="center">5</td>
</tr><tr class="even"><td align="center">0.1329</td>
<td align="center">0.1359</td>
<td align="center">0.142</td>
<td align="center">0.1388</td>
<td align="center">0.1354</td>
<td align="center">0.137</td>
<td align="center">10</td>
</tr><tr class="odd"><td align="center">0.149</td>
<td align="center">0.1548</td>
<td align="center">0.1549</td>
<td align="center">0.1529</td>
<td align="center">0.1465</td>
<td align="center">0.1516</td>
<td align="center">15</td>
</tr></tbody></table><p>Parallelization is available. You can specify the number of threads via <code>nthread</code> parameter.</p>
</div>
<div id="plot-decision-boundaries" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#plot-decision-boundaries" class="anchor"> </a></body></html>Plot Decision Boundaries</h2>
<p>The <strong>fastknn</strong> provides a plotting function to draw classification decision boundaries for bi-dimensional datasets.</p>
<div id="two-class-toy-example" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#two-class-toy-example" class="anchor"> </a></body></html>Two-class Toy Example</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"spirals"</span>, <span class="dt">package =</span> <span class="st">"fastknn"</span>)

## Split data for training and test
<span class="kw">set.seed</span>(<span class="dv">123</span>)
tr.idx &lt;-<span class="st"> </span><span class="kw">which</span>(caTools::<span class="kw">sample.split</span>(<span class="dt">Y =</span> spirals$y, <span class="dt">SplitRatio =</span> <span class="fl">0.7</span>))
x.tr   &lt;-<span class="st"> </span>spirals$x[tr.idx, ]
x.te   &lt;-<span class="st"> </span>spirals$x[-tr.idx, ]
y.tr   &lt;-<span class="st"> </span>spirals$y[tr.idx]
y.te   &lt;-<span class="st"> </span>spirals$y[-tr.idx]

## Plot decision boudary
<span class="kw"><a href="../reference/knnDecision.html">knnDecision</a></span>(x.tr, y.tr, x.te, y.te, <span class="dt">k =</span> <span class="dv">10</span>, <span class="dt">method =</span> <span class="st">"dist"</span>)</code></pre></div>
<p><img src="fastknn_files/figure-html/unnamed-chunk-7-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div id="multi-class-toy-example" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#multi-class-toy-example" class="anchor"> </a></body></html>Multi-class Toy Example</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"multi_spirals"</span>, <span class="dt">package =</span> <span class="st">"fastknn"</span>)

## Split data for training and test
<span class="kw">set.seed</span>(<span class="dv">123</span>)
tr.idx &lt;-<span class="st"> </span><span class="kw">which</span>(caTools::<span class="kw">sample.split</span>(<span class="dt">Y =</span> multi_spirals$y, <span class="dt">SplitRatio =</span> <span class="fl">0.7</span>))
x.tr   &lt;-<span class="st"> </span>multi_spirals$x[tr.idx, ]
x.te   &lt;-<span class="st"> </span>multi_spirals$x[-tr.idx, ]
y.tr   &lt;-<span class="st"> </span>multi_spirals$y[tr.idx]
y.te   &lt;-<span class="st"> </span>multi_spirals$y[-tr.idx]

## Plot decision boudary
<span class="kw"><a href="../reference/knnDecision.html">knnDecision</a></span>(x.tr, y.tr, x.te, y.te, <span class="dt">k =</span> <span class="dv">10</span>, <span class="dt">method =</span> <span class="st">"dist"</span>)</code></pre></div>
<p><img src="fastknn_files/figure-html/unnamed-chunk-8-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="probability-estimation" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#probability-estimation" class="anchor"> </a></body></html>Probability Estimation</h2>
<p>The <strong>fastknn</strong> provides 2 different estimators to the class membership probabilities:</p>
<ol style="list-style-type: decimal"><li>The classical estimator based on the label proportions of the nearest neighbors. This estimator can be thought as of a <strong>voting</strong> rule.</li>
<li>A shrinkage estimator based on the distances from the nearest neighbors, so that those neighbors more close to the test observation have more importance on predicting the class label. This estimator can be thought as of a <strong>weighted voting</strong> rule. In general, it reduces log-loss.</li>
</ol><p><strong>VOTING</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">#### 5-fold cross-validation
<span class="kw">set.seed</span>(<span class="dv">123</span>)
res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fastknnCV.html">fastknnCV</a></span>(x, y, <span class="dt">k =</span> <span class="dv">10</span>, <span class="dt">method =</span> <span class="st">"vote"</span>, <span class="dt">folds =</span> <span class="dv">5</span>, <span class="dt">eval.metric =</span> <span class="st">"logloss"</span>)
res$cv_table</code></pre></div>
<table style="width:76%;" class="table"><colgroup><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="9%"><col width="4%"></colgroup><thead><tr class="header"><th align="center">fold_1</th>
<th align="center">fold_2</th>
<th align="center">fold_3</th>
<th align="center">fold_4</th>
<th align="center">fold_5</th>
<th align="center">mean</th>
<th align="center">k</th>
</tr></thead><tbody><tr class="odd"><td align="center">0.6081</td>
<td align="center">0.5524</td>
<td align="center">0.5643</td>
<td align="center">0.5682</td>
<td align="center">0.6528</td>
<td align="center">0.5892</td>
<td align="center">10</td>
</tr></tbody></table><p><strong>WEIGHTED VOTING</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">#### 5-fold cross-validation
<span class="kw">set.seed</span>(<span class="dv">123</span>)
res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fastknnCV.html">fastknnCV</a></span>(x, y, <span class="dt">k =</span> <span class="dv">10</span>, <span class="dt">method =</span> <span class="st">"dist"</span>, <span class="dt">folds =</span> <span class="dv">5</span>, <span class="dt">eval.metric =</span> <span class="st">"logloss"</span>)
res$cv_table</code></pre></div>
<table style="width:76%;" class="table"><colgroup><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="9%"><col width="4%"></colgroup><thead><tr class="header"><th align="center">fold_1</th>
<th align="center">fold_2</th>
<th align="center">fold_3</th>
<th align="center">fold_4</th>
<th align="center">fold_5</th>
<th align="center">mean</th>
<th align="center">k</th>
</tr></thead><tbody><tr class="odd"><td align="center">0.5586</td>
<td align="center">0.5039</td>
<td align="center">0.5176</td>
<td align="center">0.5181</td>
<td align="center">0.604</td>
<td align="center">0.5404</td>
<td align="center">10</td>
</tr></tbody></table></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#getting-started">Getting Started</a></li>
      <li><a href="#pre-processing">Pre-Processing</a></li>
      <li><a href="#find-the-best-k">Find the Best k</a></li>
      <li><a href="#plot-decision-boundaries">Plot Decision Boundaries</a></li>
      <li><a href="#probability-estimation">Probability Estimation</a></li>
      </ul></div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by David Pinto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
